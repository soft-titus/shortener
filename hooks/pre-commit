#!/bin/sh

# Get staged Python files inside app/ or tests/
STAGED_FILES=$(git diff --cached --name-only -- '*.py' | grep -E '^(app|tests)/')

if [ -z "$STAGED_FILES" ]; then
  echo "No staged Python files in app/ or tests/. Skipping."
  exit 0
fi

echo "Checking Black formatting..."
black --check $STAGED_FILES
if [ $? -ne 0 ]; then
  echo "Black check failed."
  exit 1
fi

echo "Running pylint..."
pylint $STAGED_FILES
if [ $? -ne 0 ]; then
  echo "Pylint failed."
  exit 1
fi

echo "Running pytest..."
pytest $STAGED_FILES
if [ $? -ne 0 ]; then
  echo "Tests failed."
  exit 1
fi

echo "All checks passed!"
exit 0
